{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block page_title %}{{ title }}{% endblock %}
{% block breadcrumb %}
<nav class="breadcrumb" aria-label="Fil d'Ariane"><a href="{% url 'flotte:dashboard' %}">Tableau de bord</a><span>›</span><a href="{% url 'flotte:parc' %}">Parc</a><span>›</span><a href="{% url 'flotte:vehicule_detail' vehicule.pk %}">{{ vehicule.libelle_court }}</a><span>›</span><span class="current">{{ title }}</span></nav>
{% endblock %}
{% block content %}
<div class="card">
  <p><strong>Véhicule:</strong> {{ vehicule.libelle_court }} ({{ vehicule.numero_chassis }})</p>
  {% if cout_total_vehicule is not None and title == 'Ajouter une facture' %}
  <p class="card-desc">Référence coût total véhicule (achat + import + dépenses + réparations) : <strong>{{ cout_total_vehicule|floatformat:0 }} FCFA</strong> — vous pouvez utiliser cette valeur comme montant suggéré.</p>
  {% endif %}
  <form method="post" class="form" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}
    {% for field in form %}
    <div class="form-group">
      <label for="{{ field.id_for_label }}">{{ field.label }}{% if field.field.required %} <span class="required">*</span>{% endif %}</label>
      <div class="form-input-wrap{% if field.name == 'numero' and numero_suggere %} form-input-wrap--with-action{% endif %}">
        {{ field }}
        {% if field.name == 'numero' and numero_suggere %}
        <button type="button" class="btn btn-ghost btn-sm" id="facture-generer-numero" data-numero-suggere="{{ numero_suggere|escapejs }}">Générer un numéro</button>
        {% endif %}
      </div>
      {% if field.name == 'numero' and numero_suggere %}
      <p class="form-hint">Suggestion automatique (FAC-année-numéro). Vous pouvez garder ce numéro ou saisir celui de la facture fournisseur.</p>
      {% endif %}
      {{ field.errors }}
    </div>
    {% endfor %}
    <div class="form-actions">
      <a href="{% url 'flotte:vehicule_detail' vehicule.pk %}" class="btn btn-ghost">Annuler</a>
      <button type="submit" class="btn btn-primary">Enregistrer</button>
    </div>
  </form>
</div>
{% if numero_suggere %}
{% block extra_js %}
<script>
(function() {
  var btn = document.getElementById('facture-generer-numero');
  var input = document.getElementById('id_numero');
  if (btn && input) {
    btn.addEventListener('click', function() {
      var val = btn.getAttribute('data-numero-suggere');
      if (val) input.value = val;
    });
  }
})();
</script>
{% endblock %}
{% endif %}
{% endblock %}
